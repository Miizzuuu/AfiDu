{% extends 'layout.html' %}

{% block title %}
    Afidu - Students
{% endblock %}

{% block content %}
  <h1>Students</h1>

  <!-- search & filter form -->
  <form method="get" id="search-filter-form">
    <input type="text" name="q" placeholder="Search students..." value="{{ request.GET.q }}">
    <select name="class_filter" onchange="this.form.submit()">
      <option value="">All Classes</option>
      {% for key, value in class_choices %}
        <option value="{{ key }}" {% if request.GET.class_filter == key %}selected{% endif %}>{{ value }}</option>
      {% endfor %}
    </select>
    <button type="submit">Search</button>
  </form>

  <a href="{% url 'students:student-add' %}">+</a>

  <table>
    <thead>
      <tr>
        <th>Profile</th>
        <th>Name</th>
        <th>Age</th>
        <th>Class</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for student in students %}
        <tr>
          <td>
            {% if student.profile_photo %}
              <img src="{{ student.profile_photo.url }}" alt="Profile" width="50">
            {% else %}
              No Image
            {% endif %}
          </td>
          <td>
            <a href="{% url 'students:student-detail' student.pk %}">{{ student.name }}</a>
          </td>
          <td>{{ student.age }}</td>
          <td>{{ student.assigned_class }}</td>
          <td>
            <details>
              <summary>â‹®</summary>
              <ul>
                <li><a href="{% url 'students:student-edit' student.pk %}">Edit</a></li>

                <!-- pake link edit student dibawah jika mau kembali ke student yang di select setelah edit -->
                <!-- <li><a href="{% url 'students:student-edit' student.pk %}?next={{ request.path }}">Edit</a></li> -->
                <li><a href="{% url 'students:student-delete' student.pk %}">Delete</a></li>
              </ul>
            </details>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="4">No students found.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- item per page selector -->
  <form method="get" id="per-page-form">
    <!-- tetapkan params dari q dan class_filter -->
    <input type="hidden" name="q" value="{{ request.GET.q }}">
    <input type="hidden" name="class_filter" value="{{ request.GET.class_filter }}">
    <label for="per_page_select">Items per page:</label>
    <select name="per_page" id="per_page_select" onchange="this.form.submit()">
      <option value="5" {% if current_per_page == "5" %}selected{% endif %}>5</option>
      <option value="10" {% if current_per_page == "10" %}selected{% endif %}>10</option>
      <option value="15" {% if current_per_page == "15" %}selected{% endif %}>15</option>
    </select>
  </form>

  <!-- pageination control -->
  {% if is_paginated %}
    <div>
      <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_previous %}
        <a href="?q={{ request.GET.q }}&class_filter={{ request.GET.class_filter }}&per_page={{ current_per_page }}&page={{ page_obj.previous_page_number }}">Previous</a>
      {% endif %}
      {% if page_obj.has_next %}
        <a href="?q={{ request.GET.q }}&class_filter={{ request.GET.class_filter }}&per_page={{ current_per_page }}&page={{ page_obj.next_page_number }}">Next</a>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}

